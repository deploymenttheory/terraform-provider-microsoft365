---
page_title: "{{.Name}} {{.Type}} - {{.ProviderName}}"
subcategory: "Utility"

description: |-
{{ .Description | plainmarkdown | trimspace | prefixlines "  " }}
---

# {{.Name}}

Generates PowerShell detection and remediation scripts for managing Windows registry keys and values through Intune Proactive Remediations.

This utility data source creates production-ready PowerShell scripts that integrate directly with the `microsoft365_graph_beta_device_management_windows_remediation_script` resource. The generated scripts follow Microsoft's best practices for Proactive Remediations, including proper exit codes, error handling, and user context management.

## Typical Workflow

1. **Define** your registry configuration using this data source
2. **Generate** PowerShell detection and remediation scripts automatically
3. **Deploy** the scripts to Intune using the `microsoft365_graph_beta_device_management_windows_remediation_script` resource
4. **Monitor** compliance through Intune's Proactive Remediations reporting

## Key Features

- **Automated Script Generation**: No need to write PowerShell - define your registry settings declaratively
- **Direct Intune Integration**: Output attributes map directly to the Windows remediation script resource
- **Dual Context Support**: Handles both current user (HKCU) and all users (HKU) scenarios
- **Comprehensive Type Support**: All 6 common Windows registry value types (String, DWORD, QWORD, Multi-String, ExpandString, Binary)
- **Best Practice Compliance**: Includes proper exit codes (0/1), system account exclusions, and error handling
- **Infrastructure as Code**: Manage registry policies alongside other Intune configurations

## Version History

| Version | Status | Notes |
|---------|--------|-------|
| v0.35.0-alpha | Experimental | Initial release |

## Example Usage

{{ tffile "examples/data-sources/microsoft365_utility_windows_remediation_script_registry_key_generator/datasource.tf" }}

## Argument Reference

* `context` - (Required) The execution context for the registry operation. Valid values:
  - `current_user`: Targets HKEY_CURRENT_USER for the logged-on user. Maps to `run_as_account = "user"` in the remediation script resource.
  - `all_users`: Targets HKEY_USERS for all user profiles on the device. Maps to `run_as_account = "system"` in the remediation script resource.

* `registry_key_path` - (Required) The registry key path relative to the user hive (without HKCU or HKU prefix).
  Example: `Software\\Policies\\Microsoft\\WindowsStore\\` or `Software\\MyApp\\Settings`.
  **Note**: Use double backslashes (`\\`) to escape path separators in HCL.

* `value_name` - (Required) The name of the registry value to manage. Use `(Default)` to target the default value of a key.

* `value_type` - (Required) The registry value type. Valid values:
  - `REG_SZ`: String value
  - `REG_DWORD`: 32-bit integer value (0 to 4,294,967,295)
  - `REG_QWORD`: 64-bit integer value
  - `REG_MULTI_SZ`: Multi-string value (separate strings with `\n` in `value_data`)
  - `REG_EXPAND_SZ`: Expandable string value (supports environment variables like `%ProgramFiles%`)
  - `REG_BINARY`: Binary data (provide as hex string in `value_data`, e.g., '01AF3C')

* `value_data` - (Required) The desired value data. Format depends on `value_type`:
  - `REG_SZ`, `REG_EXPAND_SZ`: String (e.g., `"Enabled"`)
  - `REG_DWORD`, `REG_QWORD`: Decimal integer as string (e.g., `"1"`, `"255"`)
  - `REG_MULTI_SZ`: Newline-separated strings (e.g., `"Line1\nLine2\nLine3"`)
  - `REG_BINARY`: Hexadecimal string (e.g., `"01AF3C"`)

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The ID of this data source (same as `context` value).

* `detection_script` - Generated PowerShell detection script. This script:
  - Checks if the registry key and value exist and match the desired state
  - Returns exit code `0` if compliant (no action needed)
  - Returns exit code `1` if non-compliant (triggers remediation)
  - Use as the value for `detection_script_content` in `microsoft365_graph_beta_device_management_windows_remediation_script`

* `remediation_script` - Generated PowerShell remediation script. This script:
  - Creates the registry key if it doesn't exist
  - Creates or updates the registry value to the desired state
  - Returns exit code `0` on successful remediation
  - Use as the value for `remediation_script_content` in `microsoft365_graph_beta_device_management_windows_remediation_script`


### Context and run_as_account Mapping

| Data Source `context` | Resource `run_as_account` | Registry Hive | Use Case |
|-----------------------|---------------------------|---------------|----------|
| `current_user` | `user` | HKEY_CURRENT_USER | Per-user settings, user preferences |
| `all_users` | `system` | HKEY_USERS (all profiles) | Machine-wide settings, apply to all users |

## Important Considerations

### System Account Exclusions

When using `all_users` context, the generated scripts automatically exclude system accounts:
- `S-1-5-18` (LOCAL SYSTEM)
- `S-1-5-19` (LOCAL SERVICE)
- `S-1-5-20` (NETWORK SERVICE)
- `.DEFAULT` (Default user profile)
- `*_Classes` (Registry classes hives)

### Registry Key Paths

- Paths are relative to the user hive - do not include `HKCU:\` or `HKU:\` prefixes
- Always use double backslashes in HCL: `Software\\Path\\To\\Key\\`
- Trailing backslash is optional but recommended for clarity

### Permissions and Elevation

- **User context** (`current_user`): Scripts run as the logged-on user, suitable for HKCU settings
- **System context** (`all_users`): Scripts run as SYSTEM, suitable for applying settings to all user profiles
- Some registry keys may require additional permissions even in SYSTEM context

{{ .SchemaMarkdown | trimspace }}
