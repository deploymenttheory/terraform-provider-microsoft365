---
page_title: "microsoft365_graph_beta_windows_365_cloud_pc_provisioning_policy Resource - terraform-provider-microsoft365"
subcategory: "Windows 365"

description: |-
  
---

# microsoft365_graph_beta_windows_365_cloud_pc_provisioning_policy (Resource)



## Microsoft Documentation

- [cloudPcProvisioningPolicy resource type (beta)](https://learn.microsoft.com/en-us/graph/api/resources/cloudpcprovisioningpolicy?view=graph-rest-beta)
- [Create cloudPcProvisioningPolicy (beta)](https://learn.microsoft.com/en-us/graph/api/virtualendpoint-post-provisioningpolicies?view=graph-rest-beta)

## API Permissions

The following API permissions are required in order to use this resource.

### Microsoft Graph

- **Application**: `CloudPC.ReadWrite.All`

## Version History

| Version | Status | Notes |
|---------|--------|-------|
| v0.19.0-alpha | Experimental | Initial release |

## Example Usage

```terraform
resource "microsoft365_graph_beta_windows_365_cloud_pc_provisioning_policy" "win_365_with_hybrid_ad_join" {
  display_name             = "test"
  description              = ""
  cloud_pc_naming_template = "CPC-%USERNAME:5%-%RAND:5%"
  image_id                 = "microsoftwindowsdesktop_windows-ent-cpc_win11-24H2-ent-cpc-m365"
  image_type               = "gallery"
  enable_single_sign_on    = true
  provisioning_type        = "dedicated"
  managed_by               = "windows365"

  domain_join_configurations = [
    {
      domain_join_type = "azureADJoin"
      region_name      = "automatic"
      region_group     = "asia"
    }
  ]

  windows_setting = {
    locale = "en-US"
  }

  # microsoft_managed_desktop = {
  #   managed_type = "starterManaged"
  #   profile      = null
  #   type         = "starterManaged"
  # }

  # autopatch = {
  #   autopatch_group_id = "4aa9b805-9494-4eed-a04b-ed51ec9e631e"
  # }

  apply_to_existing_cloud_pcs = {
    microsoft_entra_single_sign_on_for_all_devices        = false
    region_or_azure_network_connection_for_all_devices    = true
    region_or_azure_network_connection_for_select_devices = false
  }

  scope_ids = ["9", "8"]

  assignments = [
    {
      group_id = "af5dbc68-0ee3-485c-b85c-e27bbfff44c2"
      # Only group_id for dedicated
    }
  ]
}

resource "microsoft365_graph_beta_windows_365_cloud_pc_provisioning_policy" "frontline_with_entra_id" {
  display_name             = "test"
  description              = ""
  cloud_pc_naming_template = "CPC-%USERNAME:5%-%RAND:5%"
  image_id                 = "microsoftwindowsdesktop_windows-ent-cpc_win11-24H2-ent-cpc-m365"
  image_type               = "gallery"
  enable_single_sign_on    = false
  provisioning_type        = "sharedByUser"
  managed_by               = "windows365"

  domain_join_configurations = [
    {
      domain_join_type = "azureADJoin"
      region_name      = "automatic"
      region_group     = "asia"
    }
  ]

  windows_setting = {
    locale = "en-US"
  }

  microsoft_managed_desktop = {
    managed_type = "notManaged"
  }

  scope_ids = ["9", "8"]

  apply_to_existing_cloud_pcs = {
    microsoft_entra_single_sign_on_for_all_devices        = false
    region_or_azure_network_connection_for_all_devices    = true
    region_or_azure_network_connection_for_select_devices = false
  }

  assignments = [
    {
      group_id                = "af5dbc68-0ee3-485c-b85c-e27bbfff44c2"
      service_plan_id         = data.microsoft365_graph_beta_windows_365_cloud_pc_frontline_service_plan.all.items[0].id
      allotment_license_count = 1
      allotment_display_name  = "Frontline Allotment"
    }
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `display_name` (String) The display name for the provisioning policy.
- `image_id` (String) The unique identifier that represents an operating system image used for provisioning new Cloud PCs. Must be one of:'microsoftwindowsdesktop_windows-ent-cpc_win11-24H2-ent-cpc','microsoftwindowsdesktop_windows-ent-cpc_win11-24H2-ent-cpc-m365','microsoftwindowsdesktop_windows-ent-cpc_win11-23h2-ent-cpc-m365','microsoftwindowsdesktop_windows-ent-cpc_win11-23h2-ent-cpc'.
- `microsoft_managed_desktop` (Attributes) This block is currently not supported in terraform. The registration to the Autopatch service currently only suports the intune gui,with no publically available api to call. This will return a 403 error if this block is used. Raise a ticket with Microsoft to make the Autopatch service available via api.The specific settings for Microsoft Managed Desktop that enables Microsoft Managed Desktop customers to get device managed experience for Cloud PC. (see [below for nested schema](#nestedatt--microsoft_managed_desktop))
- `windows_setting` (Attributes) Indicates a specific Windows setting to configure during the creation of Cloud PCs for this provisioning policy. (see [below for nested schema](#nestedatt--windows_setting))

### Optional

- `apply_to_existing_cloud_pcs` (Attributes) If you change the network, image, region or single sign-on configuration in a provisioning policy,no change will occur for previously provisioned Cloud PCs. Newly provisioned or reprovisioned Cloud PCs will honor thechanges in your provisioning policy. To change the network or image of previously provisioned Cloud PCs to align with the changes,you must reprovision those Cloud PCs. To change the region or single sign-on of previously provisioned Cloud PCs to align with the changes,you must apply the changed configuration retrospectively using the apply_to_existing_cloud_pcs block. (see [below for nested schema](#nestedatt--apply_to_existing_cloud_pcs))
- `assignments` (Attributes List) Assignments of the Cloud PC provisioning policy to groups. Only Microsoft 365 groups and security groups in Microsoft Entra ID are currently supported. (see [below for nested schema](#nestedatt--assignments))
- `autopatch` (Attributes) Autopatch settings for the provisioning policy. (see [below for nested schema](#nestedatt--autopatch))
- `autopilot_configuration` (Attributes) Autopilot configuration for the provisioning policy. (see [below for nested schema](#nestedatt--autopilot_configuration))
- `cloud_pc_naming_template` (String) Create unique names for your devices. Names must be between 5 and 15 characters, and can contain letters, numbers, and hyphens. Names cannot include a blank space. Use the %USERNAME:x% macro to add the first x letters of username. Use the %RAND:y% macro to add a random alphanumeric string of length y, y must be 5 or more. Names must contain a randomized string.For example, CPC-%USERNAME:4%-%RAND:5% means that the name of the Cloud PC starts with CPC-, followed by a four-character username, a - character, and then five random characters. The total length of the text generated by the template can't exceed 15 characters. Supports $filter, $select, and $orderby.
- `description` (String) The provisioning policy description. Supports $filter, $select, and $orderBy.
- `domain_join_configurations` (Attributes List) Specifies a list ordered by priority on how Cloud PCs join Microsoft Entra ID (Azure AD). (see [below for nested schema](#nestedatt--domain_join_configurations))
- `enable_single_sign_on` (Boolean) True if the provisioned Cloud PC can be accessed by single sign-on. False indicates that the provisioned Cloud PC doesn't support this feature. The default value is false.
- `image_type` (String) The type of operating system image (custom or gallery) that is used for provisioning on Cloud PCs. Possible values are: gallery, custom. The default value is gallery. Supports $filter, $select, and $orderBy.
- `local_admin_enabled` (Boolean) When true, the local admin is enabled for Cloud PCs; false indicates that the local admin isn't enabled for Cloud PCs. The default value is false. Supports $filter, $select, and $orderBy.
- `managed_by` (String) Specifies which service manages the Cloud PC provisioning policy. Possible values: windows365, devBox, unknownFutureValue, rpaBox. See Microsoft Graph documentation for details.
- `provisioning_type` (String) Specifies the type of license used when provisioning Cloud PCs using this policy.By default, the license type is dedicated if the provisioningType isn't specified when you create the cloudPcProvisioningPolicy.Possible values are: dedicated, shared, sharedByUser, sharedByEntraGroup, unknownFutureValue.Changes to this attribute will force recreation of the resource.dedicated: (Enterprise) Each user will get their own Cloud PC without restrictions on when they can connect to it.shared: (Frontline - Dedicated) Recommended for users who need part time access to their Cloud PCs or follow a set schedule, such as shifts. A single license lets you provision up to three Cloud PCs that can be used non-concurrently, each assigned to a single user. Provides one concurrent session.sharedByEntraGroup: (Frontline - Shared) Recommended for users who use Cloud PC for a short period of time and do not require data to be preserved. A single license lets you provision one Cloud PC that can be shared non-concurrently among a group of users. Provides one concurrent session.
- `scope_ids` (Set of String) Set of scope tag IDs for this resource.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))

### Read-Only

- `alternate_resource_url` (String) The URL of the alternate resource that links to this provisioning policy. Read-only.
- `cloud_pc_group_display_name` (String) The display name of the Cloud PC group that the Cloud PCs reside in. Read-only.
- `grace_period_in_hours` (Number) The number of hours to wait before reprovisioning/deprovisioning happens. Read-only.
- `id` (String) The unique identifier of the provisioning policy.
- `image_display_name` (String) The display name of the operating system image that is used for provisioning. Supports $filter, $select, and $orderBy.

<a id="nestedatt--microsoft_managed_desktop"></a>
### Nested Schema for `microsoft_managed_desktop`

Optional:

- `managed_type` (String) Indicates the provisioning policy associated with Microsoft Managed Desktop settings.
- `profile` (String) The name of the Microsoft Managed Desktop profile that the Windows 365 Cloud PC is associated with.'4aa9b805-9494-4eed-a04b-ed51ec9e631e' is the default Autopatch Group ID. Via 'https://mmdls.microsoft.com/device/v1/windows365/autopatchGroups'


<a id="nestedatt--windows_setting"></a>
### Nested Schema for `windows_setting`

Required:

- `locale` (String) The Windows language or region tag to use for language pack configuration and localization of the Cloud PC. The default value is en-US, which corresponds to English (United States).


<a id="nestedatt--apply_to_existing_cloud_pcs"></a>
### Nested Schema for `apply_to_existing_cloud_pcs`

Optional:

- `microsoft_entra_single_sign_on_for_all_devices` (Boolean) When true, Microsoft Entra single sign-on is applied to all existing Cloud PCs. Applied only during resource updates and not during resource creation. Default is false.
- `region_or_azure_network_connection_for_all_devices` (Boolean) When true, region or Azure network connection settings are applied to all existing Cloud PCs. Applied only during resource updates and not during resource creation. Default is false.
- `region_or_azure_network_connection_for_select_devices` (Boolean) When true, region or Azure network connection settings are applied only to selected Cloud PCs. Applied only during resource updates and not during resource creation. Default is false.


<a id="nestedatt--assignments"></a>
### Nested Schema for `assignments`

Required:

- `group_id` (String) The ID of the Microsoft 365 group or security group in Microsoft Entra ID to assign the policy to.

Optional:

- `allotment_display_name` (String) A display name for the allotment. Required when provisioning_type is 'shared', 'sharedByUser', or 'sharedByEntraGroup'.
- `allotment_license_count` (Number) The number of licenses to allot. Required when provisioning_type is 'shared', 'sharedByUser', or 'sharedByEntraGroup'.The number must be between 0 and 900 and can't be more than the number of shared Cloud PC licenses available.
- `service_plan_id` (String) The ID of the frontlineservice plan. Required when provisioning_type is 'shared', 'sharedByUser', or 'sharedByEntraGroup'.This value can be obtained from the 'microsoft365_graph_beta_windows_365_cloud_pc_frontline_service_plan' data source.

Read-Only:

- `id` (String) The unique identifier for the assignment. This is auto-generated and should not be specified.


<a id="nestedatt--autopatch"></a>
### Nested Schema for `autopatch`

Optional:

- `autopatch_group_id` (String) The ID of the autopatch group.


<a id="nestedatt--autopilot_configuration"></a>
### Nested Schema for `autopilot_configuration`

Optional:

- `application_timeout_in_minutes` (Number) The application timeout in minutes.
- `device_preparation_profile_id` (String) The ID of the device preparation profile.
- `on_failure_device_access_denied` (Boolean) Whether device access is denied on failure.


<a id="nestedatt--domain_join_configurations"></a>
### Nested Schema for `domain_join_configurations`

Required:

- `region_group` (String) The Cloud PC region group. Must be one of: default, australia, canada, usCentral, usEast, usWest, france, germany, europeUnion, unitedKingdom, japan, asia, india, southAmerica, euap, usGovernment, usGovernmentDOD, unknownFutureValue, norway, switzerland, southKorea, middleEast, mexico, australasia, europe.

Optional:

- `domain_join_type` (String) Specifies the method by which the provisioned Cloud PC joins Microsoft Entra ID.
- `on_premises_connection_id` (String) The Azure network connection ID that matches the virtual network IT admins want the provisioning policy to use when they create Cloud PCs.
- `region_name` (String) The supported Azure region where the IT admin wants the provisioning policy to create Cloud PCs. It is recommended using the Automatic option.The option allows Windows 365 to make the best selection which decreases the chance of provisioning failure.Must be one of: automatic, japaneast, eastasia.


<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
- `delete` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs.
- `read` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Read operations occur during any refresh or planning operation when refresh is enabled.
- `update` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).

## Important Notes

- **Windows 365 Cloud PC**: This resource defines provisioning policies for creating and managing Windows 365 Cloud PCs.
- **Resource Configuration**: Specifies compute resources, storage, and network settings for Cloud PCs.
- **Image Assignment**: Links to device images that will be used to create new Cloud PCs.
- **User Assignment**: Policies can be assigned to Entra ID (Azure AD) user groups for automated Cloud PC provisioning.
- **Regional Deployment**: Supports deployment across different Azure regions for optimal performance.
- **Licensing Integration**: Integrates with Windows 365 licensing to ensure compliance and proper resource allocation.
- **Automatic Provisioning**: Enables automatic Cloud PC creation when users are assigned to the policy.
- **Grace Period**: Configurable grace period before reprovisioning failed Cloud PCs.

## Import

Import is supported using the following syntax:

```shell
#!/bin/bash

# {user_id}
terraform import microsoft365_graph_beta_windows_365_cloud_pc_provisioning_policy.example 00000000-0000-0000-0000-000000000000
``` 