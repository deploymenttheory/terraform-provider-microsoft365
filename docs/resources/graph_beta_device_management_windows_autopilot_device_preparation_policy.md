---
page_title: "microsoft365_graph_beta_device_management_windows_autopilot_device_preparation_policy Resource - terraform-provider-microsoft365"
subcategory: "Device Management"

description: |-
  Manages Windows Autopilot Device Preparation Policy using the /deviceManagement/configurationPolicies endpoint. Windows Autopilot Device Preparation is used to set up and configure new devices, getting them ready for productive use by delivering consistent configurations and enhancing the setup experience.
---

# microsoft365_graph_beta_device_management_windows_autopilot_device_preparation_policy (Resource)

Manages Windows Autopilot Device Preparation Policy using the `/deviceManagement/configurationPolicies` endpoint. Windows Autopilot Device Preparation is used to set up and configure new devices, getting them ready for productive use by delivering consistent configurations and enhancing the setup experience.

## Known Bugs 09/06/2025

- The resource leverages the `setEnrollmentTimeDeviceMembershipTarget` endpoint to assign the device security group as the enrollment time device membership target.
- This currently throws a 500, despite following the documentation, graph x-ray and browser developer tools.

## Microsoft Documentation

- [Windows Autopilot Device Preparation](https://learn.microsoft.com/en-us/autopilot/device-preparation/overview)
- [deviceManagementConfigurationPolicy resource type](https://learn.microsoft.com/en-us/graph/api/resources/intune-deviceconfigv2-devicemanagementconfigurationpolicy?view=graph-rest-beta)

## API Permissions

The following API permissions are required in order to use this resource.

### Microsoft Graph

- **Application**: `DeviceManagementConfiguration.ReadWrite.All`

## Version History

| Version | Status | Notes |
|---------|--------|-------|
| v0.16.0-alpha | Experimental | Initial release |

## Example Usage

```terraform
resource "microsoft365_graph_beta_device_management_windows_autopilot_device_preparation_policy" "example" {
  name                  = "Windows Autopilot Device Preparation Policy"
  description           = "Example Windows Autopilot Device Preparation Policy"
  role_scope_tag_ids    = ["0"]
  device_security_group = "12345678-1234-1234-1234-123456789012" # ID of the assigned security device group that must have the 'Intune Provisioning Client' service principal (AppId: f1346770-5b25-470b-88bd-d5744ab7952c) as its owner

  deployment_settings = {
    deployment_mode = "enrollment_autopilot_dpp_deploymentmode_0" # Standard mode
    deployment_type = "enrollment_autopilot_dpp_deploymenttype_0" # User-driven
    join_type       = "enrollment_autopilot_dpp_jointype_0"       # Azure AD joined
    account_type    = "enrollment_autopilot_dpp_accountype_0"     # Standard user
  }

  oobe_settings = {
    timeout_in_minutes   = 60
    custom_error_message = "Contact your IT department for assistance."
    allow_skip           = false
    allow_diagnostics    = true
  }

  allowed_apps = [
    {
      app_id   = "12345678-1234-1234-1234-123456789012" # Example Windows Store app
      app_type = "winGetApp"
    },
    {
      app_id   = "23456789-2345-2345-2345-234567890123" # Example Win32 app
      app_type = "win32LobApp"
    },
    {
      app_id   = "34567890-3456-3456-3456-345678901234" # Example Office app
      app_type = "officeSuiteApp"
    },
    {
      app_id   = "45678901-4567-4567-4567-456789012345" # Example Universal app
      app_type = "windowsUniversalAppX"
    }
  ]

  allowed_scripts = [
    "12345678-1234-1234-1234-123456789012", # Example script ID
    "12345678-1234-1234-1234-123456789012",
  ]

  assignments = {
    include_group_ids = [
      "12345678-1234-1234-1234-123456789012", # Example group ID
      "12345678-1234-1234-1234-123456789012",
    ]
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `deployment_settings` (Attributes) Deployment settings for the Windows Autopilot Device Preparation policy (see [below for nested schema](#nestedatt--deployment_settings))
- `device_security_group` (String) The ID of the assigned security device group that devices will be automatically added to during the Windows Autopilot Device Preparation flow. This group must have the 'Intune Provisioning Client' service principal (AppId: f1346770-5b25-470b-88bd-d5744ab7952c) set as its owner. In some tenants, this service principal may appear as 'Intune Autopilot ConfidentialClient'.
- `name` (String) Policy name
- `oobe_settings` (Attributes) Out-of-box experience settings for the Windows Autopilot Device Preparation policy (see [below for nested schema](#nestedatt--oobe_settings))

### Optional

- `allowed_apps` (Attributes List) List of applications that are allowed to be installed during the Windows Autopilot Device Preparation process. Maximum of 10 items. (see [below for nested schema](#nestedatt--allowed_apps))
- `allowed_scripts` (List of String) List of script IDs that are allowed to be executed during the Windows Autopilot Device Preparation process. Maximum of 10 items.
- `assignments` (Attributes) The assignment configuration for this Windows Autopilot Device Preparation policy (see [below for nested schema](#nestedatt--assignments))
- `description` (String) Optional description for the Windows Autopilot Device Preparation policy.
- `role_scope_tag_ids` (Set of String) Set of scope tag IDs for this Entity instance.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))

### Read-Only

- `created_date_time` (String) Creation date and time of the policy
- `id` (String) The unique identifier for this policy
- `is_assigned` (Boolean) Indicates if the policy is assigned to any scope
- `last_modified_date_time` (String) Last modification date and time of the policy
- `platforms` (String) The platforms this policy applies to (e.g., windows10)
- `settings_count` (Number) Number of settings with the policy. This will change over time as the resource is updated.
- `technologies` (String) The technology this policy is using (e.g., enrollment)
- `template_family` (String) The template family for this policy (e.g., enrollmentConfiguration)
- `template_id` (String) The template ID used by this policy

<a id="nestedatt--deployment_settings"></a>
### Nested Schema for `deployment_settings`

Optional:

- `account_type` (String) The account type for users in the Windows Autopilot Device Preparation policy. Valid values are: 'enrollment_autopilot_dpp_accountype_0' (Standard User) or 'enrollment_autopilot_dpp_accountype_1' (Administrator).
- `deployment_mode` (String) The deployment mode for the Windows Autopilot Device Preparation policy. Valid values are: 'enrollment_autopilot_dpp_deploymentmode_0' (Standard mode) or 'enrollment_autopilot_dpp_deploymentmode_1' (Enhanced mode).
- `deployment_type` (String) The deployment type for the Windows Autopilot Device Preparation policy. Valid values are: 'enrollment_autopilot_dpp_deploymenttype_0' (User-driven) or 'enrollment_autopilot_dpp_deploymenttype_1' (Self-deploying).
- `join_type` (String) The join type for the Windows Autopilot Device Preparation policy. Valid values are: 'enrollment_autopilot_dpp_jointype_0' (Entra ID joined) or 'enrollment_autopilot_dpp_jointype_1' (Entra ID hybrid joined).


<a id="nestedatt--oobe_settings"></a>
### Nested Schema for `oobe_settings`

Optional:

- `allow_diagnostics` (Boolean) Whether to allow users to access diagnostics information during setup
- `allow_skip` (Boolean) Whether to allow users to skip setup after multiple failed attempts
- `custom_error_message` (String) The custom error message to display if the deployment fails. Maximum length is 1000 characters.
- `timeout_in_minutes` (Number) The timeout in minutes for the Windows Autopilot Device Preparation policy. Valid range is 15-720 minutes.


<a id="nestedatt--allowed_apps"></a>
### Nested Schema for `allowed_apps`

Required:

- `app_id` (String) The ID of the application.
- `app_type` (String) The type of the application. Valid values are: 'winGetApp', 'win32LobApp', 'officeSuiteApp', 'windowsUniversalAppX'.


<a id="nestedatt--assignments"></a>
### Nested Schema for `assignments`

Optional:

- `include_group_ids` (List of String) A list of user group IDs to include in the assignment


<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
- `delete` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs.
- `read` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Read operations occur during any refresh or planning operation when refresh is enabled.
- `update` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).

## Important Notes

- **Device Security Group**: The specified device security group must be an assigned security device group with the "Intune Provisioning Client" service principal (AppId: f1346770-5b25-470b-88bd-d5744ab7952c) set as its owner. Devices will be automatically added to this group during the Windows Autopilot device preparation deployment process. The service principal may sometimes appear as "Intune Autopilot ConfidentialClient" in some tenants.
- **Deployment Settings**: Configure how the device will be deployed, including join type and account permissions.
- **OOBE Settings**: Control the out-of-box experience, including timeouts and error messages.
- **Application and Script Allowlists**: Specify which applications and scripts can be installed/executed during setup.
- **Assignments**: Policies can be assigned to specific user groups for targeted deployment.

## Import

Import is supported using the following syntax:

```shell
#!/bin/bash
terraform import microsoft365_graph_beta_windows_autopilot_device_preparation_policy.example 00000000-0000-0000-0000-000000000000
``` 